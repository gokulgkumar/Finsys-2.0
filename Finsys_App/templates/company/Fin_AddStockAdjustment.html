{% extends 'company/Fin_base.html' %}
{% block body %}
    {% load static %}
    

<style>

.itm {

        width: 300px!important;
    }
    .inneritm{
        width: 300px!important;
       
    }

    .form-control.selectss3 {
        width: 350px;
    }

    .item_select2{
      width: 300px!important;
    }
    .item_selectss2{
      width: 300px!important;
    }

    .inneritm2{
      width: 300px!important;

    }

  
    .form-control.select2,
  .select2-container--default .select2-selection--single {
      background-color: #41586bff !important;
      color: black !important;
  }

  .select2-container--default .select2-selection--single .select2-selection__rendered {
      color: white !important;
  }

  .select2-container--default .select2-search--dropdown .select2-search__field {
      background-color: black !important;
      color: white !important;
  }

  .select2-container--default .select2-results__option {
      background-color: black !important;
      color: white !important;
  }

  .select2-container--default .select2-results__option:hover {
      background-color: #274a81 !important;
      color: white !important;
  }

  .select2-container--default .select2-results__option[aria-disabled=true] {
      background-color: black !important;
  }

  .select2-container--default .select2-results__option--highlighted[aria-selected] {
      background-color: black !important;
      color: white;
  }

  #quantityDiv {
      display: none;
  }

  .select2-selection__rendered {
      line-height: 31px !important;
  }

  .select2-container .select2-selection--single {
      height: 38px !important;
      font-size: 16px;
  }

  .select2-selection__arrow {
      height: 44px !important;
  }
     
        
</style>


    <div class="page-content">
        <div class="card radius-15">
            <div class="card-body">
                <div class="card-title">
                    <center>
                        <h2 class="mb-0" style="">NEW ADJUSTMENT</h2>

                        
                 
                    </center>
                  
                </div>
            </div>
        </div>
    </div>

 
    <br>

    <div class="d-flex justify-content-end mb-1">
      <a href="{% url 'StockAdjustment' %}"><i class="fa fa-times-circle text-white mx-4 p-1" style="font-size: 1.2rem;margin-left: -54px !important;"></i></a>
    </div>
    <form action="{% url 'create_stockadjustment' %}" method="POST" enctype="multipart/form-data">
    <div class="page-content" style="margin-top:-2rem ;">
      
        <div class="card radius-15">
            <div class="card-body">
                <div class="card-title">

                </div>


                
                <div class="row mt-3">
                  <div class="col-md-3">
                      {% csrf_token %}
                    <label for="" style="color: white;">Mode of Adjustment</label>

                    <select name="mode" id="adjust" class="form-control" onchange="toggleDiv()" required>
                       <option selected disabled value=""selected hidden>Choose...</option>
                     <option value="Quantity">Quantity Adjustment</option>
                 <option value="Value">Value Adjustment</option>
                </select>

                </div>
                </div>

                <div class="row mt-3">
                  <div class="col-md-3">

                   
                      <label class="col-form-label">Reference Number</label>
                 
                      <input class="form-control" type="text" id="bname" name="refno" placeholder="{{ref_no}}" required>
                  </div>
              </div>

              <div class="row mt-3">
                    <div class="col-md-3 mt-2">
                        <label for="">Date *</label>
                        <input type="date" class="form-control" id="date" name="date" placeholder="">
                    </div>

                    <script>
                      $('#date').val(new Date().toJSON().slice(0,10));
                    </script>
                    
                    <div class="col-md-3">
                        <label class="col-form-label " for="validationCustom02">Account *</label>
                        <select name="account" class="form-control text-white " required>
                           <option selected disabled value="">Choose...</option>
                          

                           <optgroup label="Expense" class="text-dark">
                         <option value="Advertising and Marketing" class="text-white">Advertising and Marketing</option>
                         <option value="Automobile Expense" class="text-white">Automobile Expense</option>
                         <option value="Bad Debt" class="text-white">Bad Debt</option>
                         <option value="Bank Fees and Charges" class="text-white">Bank Fees and Charges</option>
                         <option value="Consultant Expense" class="text-white">Consultant Expense</option>
                         <option value="Credit Card Charges" class="text-white">Credit Card Charges</option>
                         <option value="Depreciation Expense" class="text-white">Depreciation Expense</option>
                         <option value="Exchange Gain or Loss" class="text-white">Exchange Gain or Loss</option>
                         <option value="IT and Internet Expenses" class="text-white">IT and Internet Expenses</option>
                         <option value="Janitorial Expense" class="text-white">Janitorial Expense</option>
                         <option value="Lodging" class="text-white">Lodging</option>
                         <option value="Meals and Entertainment" class="text-white">Meals and Entertainment</option>
                         <option value="Other Expenses" class="text-white"> Other Expenses</option>
                         <option value="Postage" class="text-white">Postage</option>
                         <option value="Salaries and Employee Wages" class="text-white">Salaries and Employee Wages</option>
                         <option value="Telephone Expense" class="text-white">Telephone Expense</option>
                         <option value="Travel Expense" class="text-white">Travel Expense</option>
                         <option value="Uncategorized" class="text-white">Uncategorized</option>
                         <option value="Contract Assets" class="text-white">Contract Assets</option>
                         <option value="Depreciation And Amortisation" class="text-white">Depreciation And Amortisation</option>
                         <option value="Merchandise" class="text-white">Merchandise</option>
                         <option value="Raw Materials And Consumables" class="text-white">Raw Materials And Consumables</option>
                         <option value="Transportation Expense" class="text-white">Transportation Expense</option>
                         </optgroup>

                         <optgroup label="Fixed Asset" class="text-dark">
                          <option value="Furniture and Equipment" class="text-white">Furniture and Equipment</option>
                          </optgroup>

                          <optgroup label="Other Current Asset" class="text-dark">
                            <option value="Employee Advance" class="text-white">Employee Advance</option>
                            <option value="Advance Tax" class="text-white">Advance Tax</option>
                            <option value="Prepaid Expenses" class="text-white">Prepaid Expenses</option>
                            <option value="GST TCS Receivable" class="text-white">GST TCS Receivable</option>
                            <option value="GST TDS Receivable" class="text-white">GST TDS Receivable</option>
                            <option value="Input Tax Credits" class="text-white">Input Tax Credits </option>
                            <option value="Input CGST" class="text-white">Input CGST</option>
                            <option value="Reverse Charge Tax Input but not due" class="text-white">Reverse Charge Tax Input but not due</option>
                            <option value="Sales to Customers (Cash)" class="text-white">Sales to Customers (Cash)</option>
                            <option value="TDS Receivable" class="text-white">TDS Receivable</option>
                            <option value="Input SGST" class="text-white">Input SGST</option>
                            <option value="Input SGST" class="text-white">Input SGST</option>
                            <option value="Input SGST" class="text-white">Input SGST</option>
                            <option value="Input SGST" class="text-white">Input SGST</option>
                            </optgroup>

                            <optgroup label="Cost Of Goods Sold" class="text-dark">
                              <option value="Labor" class="text-white">Labor</option>
                              <option value="Materials" class="text-white">Materials</option>
                              <option value="Subcontractor" class="text-white">Subcontractor</option>
                              <option value="Cost of Goods Sold" class="text-white">Cost of Goods Sold</option>
                              <option value="Job Costing" class="text-white">Job Costing</option>
                            </optgroup>

                            <optgroup label="Long Term Liability" class="text-dark">
                              <option value="Mortgages" class="text-white">Mortgages</option>
                              <option value="Construction Loans" class="text-white">Construction Loans</option>
                            </optgroup>

                            <optgroup label="Equity" class="text-dark">
                              <option value="Drawings" class="text-white">Drawings</option>
                              <option value="Opening Balance Offset" class="text-white">Opening Balance Offset</option>
                              <option value="Owner's Equity" class="text-white">Owner's Equity</option>
                              <option value="Retained Earnings" class="text-white">Retained Earnings</option>
                              <option value="Capital Stock" class="text-white">Capital Stock</option>
                              <option value="Distributions" class="text-white">Distributions</option>
                              <option value="Dividends Paid" class="text-white">Dividends Paid</option>
                              <option value="Investments" class="text-white">Investments</option>
                            </optgroup>

                            <optgroup label="Other Current Liability" class="text-dark">
                              <option value="Employee Reimbursements" class="text-white">Employee Reimbursements</option>
                              <option value="Opening Balance Adjustments" class="text-white">Opening Balance Adjustments</option>
                              <option value="Unearned Revenue" class="text-white">Unearned Revenue</option>
                              <option value="GST Payable" class="text-white">GST Payable</option>
                              <option value="Output CGST" class="text-white">Output CGST</option>
                              <option value="Output IGST" class="text-white">Output IGST</option>
                              <option value="Output SGST" class="text-white">Output SGST</option>
                              <option value="TDS Payable" class="text-white">TDS Payable</option>
                            </optgroup>

                            {% for a in accounts %}
                            {% if a.account_type == 'Bank' %}
                            <optgroup label="Bank" class="text-dark">
                              <option value="{{ a.account_name }}" class="text-white">{{ a.account_name }}</option>
                            </optgroup>
                            {% endif %}
                            {% endfor %}

                            <optgroup label="Cash" class="text-dark">
                              {% for a in accounts %}
                                {% if a.account_type == 'Cash' %}
                                  <option value="{{ a.account_name }}" class="text-white">{{ a.account_name }}</option>
                                {% endif %}
                              {% endfor %}
                            </optgroup>
                       
            
                            <optgroup label="Credit Card" class="text-dark">
                            {% for a in accounts %}
                            {% if a.account_type == 'Credit Card' %}
                              <option value="{{ a.account_name }}" class="text-white">{{ a.account_name }}</option>
                            {% endif %}
                            {% endfor %}
                            </optgroup>

                           
                            <optgroup label="Payment Clearing Account" class="text-dark">
                              {% for a in accounts %}
                              {% if a.account_type == 'Payment Clearing Account' %}
                              <option value="{{ a.account_name }}" class="text-white">{{ a.account_name }}</option>
                              {% endif %}
                              {% endfor %}  
                            </optgroup>
                            

                    </select>
            </div>

            <div class="col-md-3 ">
              <label class="col-form-label" for="validationCustom03">Reason * </label>
              
              <div class="d-flex">
                <select name="reason" class="form-control" id="reasons1" required>
              <option selected disabled value="">Choose...</option>
              {% for i in reason %}
              <option value="{{ i.reason }}">{{ i.reason }}</option>
              
              {% endfor %}
             </select>

       <a href="#newreason"class="btn btn-outline-secondary ml-1" data-toggle="modal">+</a>

  </div>
</div>
</div>


        <div class="row">
          <div class="col-md-3 mt-3">
            <label class="col-form-label">Description</label>
           <textarea name="desc" rows="5" class="form-control"></textarea>
          </div>
          <div class="col-md-3 mt-3"></div>
          <div class="col-md-3 mt-3"></div>
          <div class="col-md-3 mt-3"></div>
        </div>

        <br>


           






<!----------------------------------------------------------- Quantity Adjustment ------------------------------------------------------------->
<div class="row" id="quantityDiv">
  <div class="col-md-12 table-responsive-md mt-3">
    <table class="table table-bordered table-hover mt-3" id="item_table">
      <thead>
        <tr>
          <th class="text-center">Sl No.</th>
          <th class="text-center">Item details</th>
          <th class="text-center">Quantity Available</th>
          <th class="text-center">New Quantity on hand</th>
          <th class="text-center">Quantity Adjusted</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="item_table_tbody1">
 
        <tr id='row1'>
          <td class="bg-transparent text-white rownum" id="" value=""></td>
          <td>
              <div class='form-group mt-3'>
                <select class='  item_select  text-white itm select2 mt-1 inneritem1' name='item1' id='selectss1' onchange="selectonchange()" >

                      <option id="selectitem" disabled hidden selected >Select Items </option>
                      {% for i in items %}
                      <option class="text-dark" value="{{i.name}}" data-stock="{{i.stock}}" >{{i.name}}</option>
                      {% endfor %}

                  </select>
                  <a><button type="button" class="btn btn-outline-secondary" data-target="#newitem" data-toggle="modal">+</button></a>
              </div>
          </td>
          <td class='text-right text-dark ' ><input type='number' step="0.01" class='form-control  border-1  text-light text-right qty ' value='' name="qtyav[]" id="quant">
          </td>
          <td class='text-right'><input type='number' id='onhandqty' class='form-control border-1  text-light text-right rate' name='newqty[]' value=''>
          </td>
          
          <td class='text-right'><input type='text' id='diff' class='form-control border-1  text-light text-right discount' name='qtyadj[]' value=''>
          </td>
          <td class='text-center'>
              <button type='button' id='del_btn1' class='btn btn-outline-secondary  delete-row'>-</button> 
          </td>
      </tr>
      </tbody>
    </table> 
    <button type="button" class="btn btn-outline-secondary tab1" id="add-row" title="add row">+</button>

  </div>
</div>



<script>
  // FIRST ROW
  let rowNum = 1;
  const rownumber = document.querySelector('.rownum');
  rownumber.innerHTML = rowNum;
  
  document.addEventListener('DOMContentLoaded', function() {
      const itemSelect = document.querySelector('.item_select');
      const qtyInput = document.querySelector('.qty');
      const onhandqtyInp = document.getElementById('onhandqty');
      const diffInput = document.getElementById('diff');

      console.log(itemSelect,'itemSelect')
  
      itemSelect.addEventListener('change', function() {
          const selectedOption = itemSelect.options[itemSelect.selectedIndex];
          const stock = selectedOption.getAttribute('data-stock');
          qtyInput.value = stock;
          updateDifference();
      });
  
      onhandqtyInp.addEventListener('input', function() {
        updateDifference();
      });
  
      function updateDifference() {
          const rateValue = parseFloat(onhandqtyInp.value) || 0;
          const qtyValue = parseFloat(qtyInput.value) || 0;
          const difference = rateValue - qtyValue;
          diffInput.value = difference.toFixed(2);
      }
  });

  
// quantity
function selectonchange() {
  const itemSelect = document.querySelector('.item_select');
  const qtyInput = document.querySelector('.qty');
  const selectedOption = itemSelect.options[itemSelect.selectedIndex];
  const selectedValue = selectedOption.value;

  console.log('selectedValue', selectedValue);

  $.ajax({
    type: "GET",
    url: "{% url 'getitemdata1' %}",
    data: {
      id: selectedValue,

  
    },
    success: function (response) {
      var stck = response.stock;
      console.log(stck,'stck')
      document.getElementById('quant').value = stck;
    },
    error: function (error) {
      console.error('Ajax request failed:', error);
    }
  });
}

  
  // NEW ROW
  document.addEventListener('DOMContentLoaded', function() {

      const addRowButton = document.getElementById('add-row');
      const tableBody = document.querySelector('#item_table_tbody1');
  
      addRowButton.addEventListener('click', function() {
          const newRow = document.createElement('tr');
          rowNum++;
  
          newRow.innerHTML = `
              <td class="bg-transparent text-light rowsNumbers" >${rowNum}</td>
              <td>
                  <div class='form-group mt-3'><select class='text-light  item_select${rowNum} inneritm  inneritem${rowNum}' name='item1' id='item${rowNum}' onchange='selectonchange2(${rowNum})'>
                          <option class='text-white'hidden disabled selected>Select Items</option>
                          {% for i in items %}
                          <option class="text-dark" value="{{i.name}}" data-stock="{{i.stock}}" >{{i.name}}</option>
                          {% endfor %}
                      </select>
                      <a><button type="button" class="btn btn-outline-secondary" data-target="#newitem" data-toggle="modal">+</button></a>
                  </div>
              </td>
              <td class='text-right'><input type='number' id='qty2${rowNum}' class='form-control    text-light text-right qty2${rowNum}'  name="qtyav[]"></td>
              <td class='text-right'><input type='number' id='rates${rowNum}' class='form-control    text-light text-right rate'  name="newqty[]" value=''></td>
              <td class='text-right'><input type='text' id='diff${rowNum}' class='form-control    text-light text-right discount' name="qtyadj[]" value=''></td>
              <td class='text-center'>
                  <button type='button' class='btn btn-outline-secondary delete-row' style='width:30px'>-</button>
              </td>
          `;
  
          tableBody.appendChild(newRow);


          $(`#item${rowNum}`).select2();

          

         

          const itemSelectNewRow = document.querySelector(`#item${rowNum}`);
          const qtyInputNewRow = document.querySelector(`.qty2${rowNum}`);
          const rateInputNewRow = document.querySelector(`#rates${rowNum}`);
          const diffInputNewRow = document.querySelector(`#diff${rowNum}`);

        
  
          itemSelectNewRow.addEventListener('change', function() {
              const selectedOption = itemSelectNewRow.options[itemSelectNewRow.selectedIndex];

              const selectedValue = selectedOption.value;
              qtyInputNewRow.value=selectedValue

              updateDiscount(diffInputNewRow, rateInputNewRow, qtyInputNewRow);
          });
  
          rateInputNewRow.addEventListener('input', function() {
              updateDiscount(diffInputNewRow, rateInputNewRow, qtyInputNewRow);
          });
  
          const deleteButton = newRow.querySelector('.delete-row');
          deleteButton.addEventListener('click', function() {
              newRow.remove();
              rowNum--;
          });
      });
  });
  

function selectonchange2(no){
  const itemSelect = document.querySelector(`.item_select${no}`);

    const qtyInput = document.querySelector(`.qty2${no}`); 
    const selectedOption = itemSelect.options[itemSelect.selectedIndex];
    const selectedValue = selectedOption.value;

     $.ajax({
    type: "GET",
    url: "{% url 'getitemdata1' %}",
    data: {
      id: selectedValue,

  
    },
    success: function (response) {
      var stck = response.stock;
      document.getElementById(`qty2${rowNum}`).value = stck;
    },
    error: function (error) {
      console.error('err', error);
    }
  });


}
  
  function updateDiscount(diffInput, rateInput, qtyInput) {
      const rateValue = parseFloat(rateInput.value) || 0;
      const qtyValue = parseFloat(qtyInput.value) || 0;
      const difference = rateValue - qtyValue;
      diffInput.value = difference.toFixed(2);
  }



  


  </script> 
     
  






<!-- <script>
  $(document).ready(function() {
   $('#selectss1').select2();
$(document).on('change', '#selectss1', function () {
                                   
    console.log('Select changed');
    var selectedValue = $(this).val();
    $.ajax({
        type: "GET",
        url: "{% url 'getitemdata1' %}",
        data: {
            id: selectedValue,
            
        },
        success: function (response) {
          var stck = response.stock;
          document.getElementById('qtyavail1').value=stck;
                                      
                              },
                                
                        });
                  });

              });
</script> -->

<script type="text/javascript">
  $(document).on('input', '#qty_hand1', function() {
    var qtyhnd = parseFloat(document.getElementById('qty_hand1').value);
    var qtyavail = parseFloat(document.getElementById('qtyavail1').value);
    var difference = qtyhnd - qtyavail
    document.getElementById('new_qty1').value=difference
  });
</script>




<!--------------------------------------------------------------------------- End Quantity Adjustment----------------------------------------------------------------->




  <!------------------------------------------------------------------------------ Value Adjustment ---------------------------------------------------------------->


    
  <div class="row" id="valueDiv">
    <div class="col-sm-12 col-lg-12 col-md-12 ">
        <label for="" id="label_tab2" class="tab2"></label><br>
        <div style="width: 100%;">
            <table class="table  text-black table-bordered tab2" id="item_table2" style="width: 100%;">
            <thead>
                <tr class="text-center">
                  <th class="" style="font-weight: bold;;">Sl No.</th>
                    <th class="" style="font-weight: bold;;"  >Item Details </th>
                    <th class="" style="font-weight: bold;;">Current Value</th>
                    <th class="" style="font-weight: bold;;">Changed Value</th>
                    <th class="" style="font-weight: bold;;">Adjusted Value</th>
                </tr>
            </thead>
            <tbody id="item_table_tbody2">

                <tr id='row2' class="">
                    <td class="bg-transparent text-light rownum2 "  ></td>
                    <td>
                        <div class='form-group mt-3'>
                          <select class=' bg-transparent text-light  item_selectss2 itm2 select2 text-left inneritem1' name='item2[]' id='item_selectss2' onchange="valuechange()">
                                <option class='text-light text-left' disabled hidden selected>Select Items</option>
                                {% for i in items %}
                              
                                <option class="text-dark" value="{{i.name}}" data-stock="{{i.stock}}" data-rate="{{i.rate}}">{{i.name}}</option>
                                {% endfor %}
                            </select>
                            <a><button type="button" class="btn btn-outline-secondary" data-target="#newitem" data-toggle="modal">+</button></a>
                           
                        </div>
                    </td>
                    <!-- id='rate1' -->
                    <td class=''><input type='number'  class='form-control bg-transparent border-1  text-light  text-right  value' id="currentval" name='cuval[]'
                            value='' style="background-color: rgb(255 255 255 / 14%)!important;">
                    </td>
                    <!-- id='rate2' -->
                    <td class=''><input type='number'  class='form-control bg-transparent border-1  text-light  text-right  changval' name='chval[]'
                            value='' style="background-color: rgb(255 255 255 / 14%)!important;" id="changval">
                    </td>
                    <!-- id='discount1' -->
                    <td class=''><input type='text'  class='form-control bg-transparent border-1  text-light  text-right  adjval' name='adjval[]'
                            value='' style="background-color: rgb(255 255 255 / 14%)!important;" id="diff2">
                    </td>
                    

                   
                    <td class='text-center'><button type='button' id='del_btn2'
                            class='btn btn-outline-secondary delete-row'
                            style='width:30px'>-</button>
                                
                              </td>
                </tr>
            </tbody>

        </table>
        <button type="button" class="btn btn-outline-secondary text-white tab2 " style=""
            id="add-row2"  title="add row">+</button>
    </div>
    

</div>

</div>
<script>
  document.addEventListener('DOMContentLoaded', function () {
      const row = document.getElementById('row2');
      const qtyInput = document.getElementById('currentval');
      const changval = row.querySelector('.changval');
      const diffInput = row.querySelector('.adjval');
      const select = row.querySelector('.item_selectss2');
  
      // Initial calculation
      updateDifference();
  
      // Event listener for item selection change
      select.addEventListener('change', function () {
          updateDifference();
      });
  
      // Event listener for changed value input
      changval.addEventListener('input', function () {
          updateDifference();
      });
  
      function updateDifference() {
          const selectedOption = select.options[select.selectedIndex];
          const selectedItem = qtyInput.value;
          const rateValue = parseFloat(changval.value) || 0;
          const qtyValue = parseFloat(selectedItem) || 0;
          const difference = qtyValue - rateValue;
          console.log(rateValue, 'rateValue');
          console.log(qtyValue, 'qtyValue');
  
          // Only set the value if the difference is not zero
          diffInput.value = difference !== 0 ? difference.toFixed(2) : '';
      }
  });
  
  </script>
  


<script>
  
  
// quantity
function selectonchange() {
  const itemSelect = document.querySelector('.item_select');
  const qtyInput = document.querySelector('.qty');
  const selectedOption = itemSelect.options[itemSelect.selectedIndex];
  const selectedValue = selectedOption.value;

  console.log('selectedValue', selectedValue);

  $.ajax({
    type: "GET",
    url: "{% url 'getitemdata1' %}",
    data: {
      id: selectedValue,

  
    },
    success: function (response) {
      var stck = response.stock;
      document.getElementById('quant').value = stck;
    },
    error: function (error) {
      console.error('Ajax request failed:', error);
    }
  });
}

</script>










<script>
  <!-- Adding row for table 1 -->
  document.addEventListener('DOMContentLoaded', function() {
    const addRowButton2 = document.getElementById('add-row2');
    let rowNum2 = 1; 

    




    addRowButton2.addEventListener('click', function() {
       
        const newRow2 = document.createElement('tr');

        rowNum2++;

        newRow2.innerHTML = `
            <td class="bg-transparent text-white">${rowNum2}</td>
            <td>
                <div class='form-group mt-3'>
                  <select class='bg-transparent item_select2${rowNum2} inneritm2 text-light text-left select2 inneritem${rowNum2}' id='item2${rowNum2}' name='item2[]' onchange='valuechange2(${rowNum2})' style="text-align:left">
                        <option class='text-light' disabled hidden selected>Select Items</option>
                        {% for i in items %}
                       
                        <option  value="{{i.name}}" data-stock="{{i.stock}}" data-rate="{{i.rate}}" >{{i.name}}</option>
                        {% endfor %}
                    </select>
                    <a><button type="button" class="btn btn-outline-secondary" data-target="#newitem" data-toggle="modal">+</button></a>
                </div>
            </td>
            <td class='text-right'><input type='number' class='form-control bg-transparent  text-light text-right values' name='cuval[]' value='' id='currentval2${rowNum2}'  style="background-color: rgb(255 255 255 / 14%)!important;"></td>
            <td class='text-right'><input type='number' class='form-control bg-transparent text-light text-right rate' name='chval[]' value=''  style="background-color: rgb(255 255 255 / 14%)!important;"></td>
            <td class='text-right'><input type='text' class='form-control bg-transparent text-light text-right discount' name='adjval[]' value=''  style="background-color: rgb(255 255 255 / 14%)!important;"></td>
            <td class='text-center'>
                <button type='button' class='btn btn-transparent btn-sm btn-outline-secondary  delete-row' style='width:30px'>-</button>
            </td>
        `;

        const tableBody2 = document.querySelector('#item_table_tbody2');
        tableBody2.appendChild(newRow2);

        $(`#item2${rowNum2}`).select2()

      
    });








    // set row number for the first row
    document.querySelector('#item_table2 tbody tr:first-child .bg-transparent').textContent = "1";

    // Event delegation for dynamic rows
    document.querySelector('#item_table2 tbody').addEventListener('change', function(e) {
      
        const target = e.target;



      


       
        if (target.classList.contains('item_select2')) {
            const selectedOption = target.options[target.selectedIndex];
            const stock = selectedOption.getAttribute('data-stock');
            const stockrate = selectedOption.getAttribute('data-rate');
            const row = target.closest('tr');

            console.log('selectedOption 2',selectedOption)

            // Calculate and set the value
            const valuesInput = row.querySelector('.values');
            valuesInput.value = stock * stockrate;

            // Recalculate adjusted value
            const valuesValue = parseFloat(valuesInput.value) || 0;
            const rateValue = parseFloat(row.querySelector('.rate').value) || 0;
            const difference2 = rateValue - valuesValue;
            row.querySelector('.discount').value = difference2.toFixed(2);
        }

        // valuechange2(target, target.closest('tr'));
    });

    document.querySelector('#item_table2 tbody').addEventListener('input', function(e) {
        const target = e.target;
        if (target.classList.contains('values') || target.classList.contains('rate')) {
            const row = target.closest('tr');
            const valuesValue = parseFloat(row.querySelector('.values').value) || 0;
            const rateValue = parseFloat(row.querySelector('.rate').value) || 0;
            const difference2 = rateValue - valuesValue;
            row.querySelector('.discount').value = difference2.toFixed(2);
        }
    });
    
    document.querySelector('#item_table2 tbody').addEventListener('click', function(e) {
        const target = e.target;
        if (target.classList.contains('delete-row')) {
            const row = target.closest('tr');
            row.remove();
            rowNum2--; 
        }
    });



    
});



// value for row 1
function valuechange(){
 const select =document.getElementById('item_selectss2')
const selectedOption = select.options[select.selectedIndex];
const selectedItem = selectedOption.value
console.log('selectedItem sasda',selectedItem)

$.ajax({
          type: "GET",
          url: "{% url 'getitemdata2' %}",
          data: {
              id: selectedItem,
              
          },
          success: function (response) {
            var val = response.value;
            document.getElementById('currentval').value=val;
                                        
                                },
                                  
                          });
                    };
                  

</script>



  

<script>
            // value-innerhtml
            function valuechange2(nos){
              const selects = document.getElementById(`item2${nos}`)
              console.log(selects,'sssss')
              const selectedOption = selects.options[selects.selectedIndex];
              const selectedItem = selectedOption.value
         
              $.ajax({
                        type: "GET",
                        url: "{% url 'getitemdata2' %}",
                        data: {
                            id: selectedItem,
                            
                        },
                        success: function (response) {
                          var val = response.value;
                          document.getElementById(`currentval2${nos}`).value=val;
                                                      
                                              },
                                                
                                        });
                                  };

       

</script>



  <script>
    $(document).ready(function() {
     $('.select2').select2();
  $(document).on('change', '#selectss3', function () {
                                     
      console.log('Select changed');
      var selectedValue = $(this).val();
      $.ajax({
          type: "GET",
          url: "{% url 'getitemdata2' %}",
          data: {
              id: selectedValue,
              
          },
          success: function (response) {
            var val = response.value;
            document.getElementById('valavail1').value=val;
                                        
                                },
                                  
                          });
                    });
  
                });
  </script>




<!-----------------------------------------------------------------------End Value Adjustment----------------------------------------------------------------->


  <br><br>

  <div class="row mt-3">
    <div class="col-md-3">
        <input class="form-control" type="file" id="file" name="file">
    </div>
</div>

<br><br>

<div class="notices mt-3">
  <div class="text-muted text-light">NOTICE:</div>
  <div class="text-muted text-light">
    <input type="checkbox" required>
    Fin sYs Terms and Conditions Apply
  </div>
</div>

<br><br>

<div class="text-center">
  <button type="submit" class="btn btn-outline-secondary text-light w-25 mx-3" name="save">
    Save
  </button>
  <button type="submit" class="btn btn-outline-secondary text-light w-25 mx-3" name="draft">
    Draft
  </button>
  
</div>


    </div>


  </form>
</form>
    <!-- ---------------------------------------------------- REASON MODAL ------------------------------------------------------------------- -->

    <div class="modal fade" id="newreason">
      <div class="modal-dialog">
     
          <div class="modal-content" style="background-color: #213b52;">
              <form action="" method="post"  id="newReasonForm"   >
                  {% csrf_token %}
              <div class="modal-header">
                  <h3 class="m-3">New Reason</h3>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="modalReason">
                      <span aria-hidden="true">&times;</span>
                  </button>
              </div>
              <div class="modal-body">
                
                
                  <div>
                      <div class="form-check">
                          <label class="form-check-label">Reason *</label> 
                          <input type="text" class="form-control" name="reason" id="reasoninp">
                         
                      </div>
    
      
                  </div>
             
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-outline-secondary text-light" id="saveReasonButton" >Save</button>
                  <button type="button" class="btn btn-outline-secondary text-light" data-dismiss="modal" id="cancelBtn">Close</button>
              </div>
          </form>
          </div>
      </div>
    </div>       
    


<script>



$(document).on("click","#saveReasonButton",function(){
  var reasons = $('#reasoninp').val();
        
            $.ajax({
                type : 'POST',
                url:"{% url 'add_reason' %}",
                data:{
                  'reason' : reasons,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                
                success: function(response) {
                    if(response.status){
                        document.getElementById("newReasonForm").reset();
                        
                        var dropdown = $('#reasons1');
                        dropdown.empty();
                        dropdown.append(`<option value="" selected>Choose</option>`);
                        $.each(response, function(key, value) {
                            for(let i=0; i<value.length; i++){
                                if(value[i].name == reasons){
                                    dropdown.append($('<option selected></option>').text(value[i].name).val(value[i].id))
                                }else{
                                    dropdown.append($('<option></option>').text(value[i].name).val(value[i].id))
                                }   
                            }
                        });

                        $('#newreason').modal('hide');

                    }else{
                        alert("Sorry this reason already exists!")
                    }
                },         
            });
    });




</script>






 <!-- ---------------------------------------------------- END REASON MODAL ------------------------------------------------------------------- -->




<!-- --------------------------------------------------------------- ITEM MODAL --------------------------------------------------------------------------- -->

 <div class="modal fade" id="newitem">
  <div class="modal-dialog modal-xl">
      <div class="modal-content" style="background-color: #213b52;">
          <div class="modal-header">
              <h3 class="m-3" id="itm_modal_head">New Item</h3>
              <button type="button" class="close" aria-label="Close" id="new_itm_close">
                  <span aria-hidden="true">&times;</span>
              </button>
              <button type="button" class="close" aria-label="Close" id="new_acc_close" style="display: none;">
                  <span aria-hidden="true">&times;</span>
              </button>
              <button type="button" class="close" aria-label="Close" id="new_unit_close" style="display: none;">
                  <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body">
              <div class="card p-3 m-3">
                  <form class="needs-validation" method="post" autocomplete="off" id="item_form">
                      {% csrf_token %}
                      <div class="row">
                          <div class="col-md-12 mx-0">
                              <div class="row">
                                  <div class="col-md-6 mt-3">
                                      <input type="text" class="new_modal_type_itm" value="Item" hidden>
                                      <label for="nitm_name" class="text-white">Name</label>
                                      <input type="text" id="nitm_name" name="nitm_name" class="form-control" autocomplete="off">
                                      <span class="font-medium text-danger" id="item-name-error"></span>
                                  </div>
                                  <div class="col-md-6 mt-3">
                                      <label for="nitm_type" class="text-white">Type</label>
                                      <select name="nitm_type" class="form-control" id="nitm_type">
                                          <option selected value="" hidden>Choose...</option>
                                          <option value="Goods">Goods</option>
                                          <option value="Services">Services</option>
                                      </select>
                                  </div>
                              </div>
                              <div class="row">
                                  <div class="col-md-6 mt-3">
                                      <label for="nitm_unit" class="text-white">Unit</label>
                                      <div class="d-flex">
                                          <select class="custom-select" name="nitm_unit" id="nitm_unit">
                                              <option selected value="" hidden>Choose...</option>
                                              {% for a in units %}
                                              <option class="text-uppercase" value="{{a.name}}">{{ a.name }}</option>
                                              {% endfor %}
                                          </select>
                                          &nbsp;&nbsp;&nbsp;
                                          <a class="btn btn-outline-secondary" id="new_unit_btn">+</a>
                                      </div>
                                  </div>
                                  <div class="col-md-6 mt-3">
                                      <label for="nitm_hsn" class="text-white">HSN Code</label>
                                      <input type="number" name="nitm_hsn" class="form-control" placeholder="Enter a valid HSN code" id="nitm_hsn">
                                      <span class="font-medium text-danger" id="item-hsn-error"></span>
                                  </div>
                              </div>
                              <div class="row mt-3">
                                  <div class="col-md-3 mt-3 mb-3">
                                      <label class="text-white">Tax Reference</label>
                                  </div>
                                  <div class="col-md-3">
                                      <div class="form-check mt-3 mb-3">
                                          <input class="form-check-input" name="taxref" type="radio" id="inclusive" value="taxable">
                                          <label class="text-white" for="inclusive">Taxable</label>
                                      </div>
                                  </div>
                                  <div class="form-check mt-3 mb-3">
                                      <input class="form-check-input" name="taxref" type="radio" value="non taxable" id="noninclusive">
                                      <label class="text-white" for="noninclusive">Non Taxable</label>
                                  </div>
                              </div>
                              <div class="row"  id="taxableDiv" style="display: none;">
                                  <div class="col-md-6 mt-3">
                                      <label for="nitm_intra_tax" class="text-white">Intra State Tax Rate</label>
                                      <select name="nitm_intra_tax" class="form-control" id="nitm_intra_tax" >
                                          <option value=0>GST 0 (0%)</option>
                                          <option value=3>GST 3 (3%)</option>
                                          <option value=5>GST 5 (5%)</option>
                                          <option value=12>GST 12 (12%)</option>
                                          <option value=18>GST 18 (18%)</option>
                                          <option value=28>GST 28 (28%)</option>        
                                      </select>
                                  </div>
                                  <div class="col-md-6 mt-3">
                                      <label for="nitm_inter_tax" class="text-white">Inter State Tax Rate</label>
                                      <select name="nitm_inter_tax" class="form-control" id="nitm_inter_tax" >
                                          <option value=0>IGST 0 (0%)</option>
                                          <option value=3>IGST 3 (3%)</option>
                                          <option value=5>IGST 5 (5%)</option>
                                          <option value=12>IGST 12 (12%)</option>
                                          <option value=18>IGST 18 (18%)</option>
                                          <option value=28>IGST 28 (28%)</option>
                                      </select>
                                  </div>
                              </div>
                              <div class="row">
                                  <div class="col-md-6 mt-3">
                                      <label class="text-white">Purchase Price</label>
                                      <div class="row">
                                          <div class="col-md-12 d-flex">
                                              <input type="text" class="form-control col-2 mr-1" value="INR">
                                              <input type="number" name="nitm_pur_price" class="form-control" id="nitm_pur_price" value="0">
                                          </div>
                                      </div>
                                  </div>
                                  <div class="col-md-6 mt-3">
                                      <label class="text-white">Sales Price</label>
                                      <div class="row">
                                          <div class="col-md-12 d-flex">
                                              <input type="text" class="form-control col-2 mr-1" value="INR">
                                              <input type="text" name="nitm_sale_price" class="form-control" id="nitm_sale_price" value="0">
                                          </div>
                                      </div>
                                  </div>
                              </div>
                              <div class="row">
                                  <div class="col-md-6 mt-3">
                                      <label for="nitm_pur_acc" class="text-white">Account</label>
                                      <div class="d-flex">
                                          <select name="nitm_pur_acc" class="form-control" id="nitm_pur_acc">
                                              <option value="" selected hidden>Choose...</option>
                                              {% for a in account %}
                                              <option value="{{ a.account_name }}">{{ a.account_name }}</option>
                                              {% endfor %}
                                          </select>
                                          &nbsp;&nbsp;&nbsp;
                                          <a class="btn btn-outline-secondary" id="new_acc_btn">+</a>
                                      </div>
                                  </div>
                                  <div class="col-md-6 mt-3">
                                      <label for="nitm_sale_acc" class="text-white">Account</label>
                                      <select name="nitm_sale_acc" class="form-control" id="nitm_sale_acc">
                                          <option value="" selected hidden>Choose..</option>
                                          <option value="General Income">General Income</option>
                                          <option value="Interest Income">Interest Income</option>
                                          <option value="Late Fee Income">Late Fee Income</option>
                                          <option value="Discount Income">Discount Income</option>
                                          <option value="Shipping Charges">Shipping Charges</option>
                                          <option value="Other Charges">Other Charges</option>
                                      </select>
                                  </div>
                              </div>
                              <div class="row">
                                  <div class="col-md-6 mt-3">
                                      <label for="nitm_pur_acc" class="text-white">Description</label>
                                      <textarea class="form-control" name="nitm_pur_acc" id="nitm_pur_acc"></textarea>  
                                  </div>
                                  <div class="col-md-6 mt-3">
                                      <label for="nitm_sale_acc" class="text-white">Description</label>
                                      <textarea class="form-control" name="nitm_sale_acc" id="nitm_sale_acc"></textarea>
                                  </div>
                              </div>
                              <div class="row mt-3" >
                                  <div class="col-md-3">
                                      <div class="form-check">
                                          <input class="form-check-input" type="checkbox"  id="track">
                                          <label class="form-check-label" for="track">Track Inventory</label>
                                      </div>  
                                  </div>
                              </div>
                              <div class="row" id="inventorytrack" style="display: none">
                                  <div class="col-md-6 mt-3">
                                      <label class="text-white">Inventory Account</label>
                                      <select name="invacc" class="form-control" id="invacc">
                                          <option selected value="" hidden>Choose...</option>
                                          <option value="Inventory Assets">Inventory Assets</option>    
                                      </select>
                                  </div>
                                  <div class="col-md-3 mt-3">
                                      <label class="text-white">Stock on hand</label>
                                      <input type="number" name="nitm_stock" class="form-control" id="nitm_stock" value="0">
                                  </div>
                                  <div class="col-md-3 mt-3">
                                      <label class="text-white">Stock Rate per Unit</label>
                                      <input type="number" name="nitm_stock_rate" class="form-control" id="nitm_stock_rate" value="0">
                                  </div>
                              </div>
                              <div class="row" >
                                  <div class="col-md-3 mt-3">
                                      <label class="text-white">Minimum Stock to maintain</label>
                                      <input type="number" name="nitm_min_stock" class="form-control" id="nitm_min_stock" value="0">
                                  </div>
                              </div>
                          </div>
                      </div>
                      <div class="row">
                          <div class="col-md-4"></div>
                          <div class="col-md-4">
                              <button class="btn btn-outline-secondary  text-light w-100 mt-3 mb-3" type="submit">
                                  Submit
                              </button>
                          </div>
                          <div class="col-md-4"></div>
                      </div>
                  </form>

                  <form class="needs-validation" method="post" autocomplete="off" id="unit_form" style="display: none;">
                      <div class="row mt-2">
                          <div class="col-md-2"></div>
                          <div class="col-md-3">
                              <input type="text" class="new_modal_type_itm" hidden>
                              <label class="float-right mt-2" for="name">Unit Name</label>
                          </div>
                          <div class="col-md-5">
                              <input name="name" id="unit_name" class="form-control text-uppercase" >
                              <span class="font-medium text-danger" id="unit-name-error"></span>
                          </div>
                      </div>
                      <div class="row mt-4">
                          <div class="col-12 d-flex justify-content-center">
                              <button class="btn btn-outline-info text-grey" type="submit" id="saveItemUnit">Save</button>
                          </div>
                      </div>
                  </form>

                  <form class="needs-validation" method="post" autocomplete="off" id="account_form" style="display: none;">
                      <div class="row mt-2 mb-2">
                          <div class="col-md-6">
                              <div class="row mt-2">
                                  <div class="col-12">
                                      <input type="text" class="new_modal_type_itm" hidden>
                                      <label for="acctyp">Account Type</label>
                                      <input type="text" value="Assets" id="acctype" name="acctype" hidden>
                                      <select name="account_type" id="Account_type" class="custom-select-md form-control w-100" onchange="AccountTypeChange(this)" required>
                                          <optgroup label="Expense" style="background-color: rgb(47 81 111);">
                                              <option value="Expense"> Expense </option>
                                              <option value="Cost Of Goods Sold"> Cost Of Goods Sold </option>
                                              <option value="Other Expense"> Other Expense </option>
                                          </optgroup>
                                      </select>
                                  </div>
                              </div>
                              <div class="row mt-2">
                                  <div class="col-12">
                                      <label for="name">*Name</label>
                                      <input name="account_name" id="accountName" required class="custom-select-md form-control w-100">
                                  </div>
                              </div>
                              <div class="row mt-1" id="subAccountCheck" style="display: none;">
                                  <div class="col-12">
                                      <div class="form-check">
                                          <input type="checkbox" name="subAccountCheckBox" class="form-check-input" id="subAccountCheckBox">
                                          <label class="form-check-label" for="subAccountCheckBox">Make this a sub-account</label>
                                          <span><i class="fa fa-question-circle" data-toggle="tooltip" data-placement="bottom" title="Select this option if you are creating a sub-account."></i></span>
                                      </div>
                                  </div>
                              </div>
                              <div class="row mt-2" id="parentAccountValue" style="display: none;">
                                  <div class="col-12">
                                      <label for="parentAccount">Parent Account</label>
                                      <select name="parent_account" id="parentAccount" class="custom-select-md form-control w-100">
                                      </select>
                                  </div>
                              </div>
                              <div class="row mt-2">
                                  <div class="col-12">
                                      <label for="acc_code">Account Code</label>
                                      <input type="text" name="account_code" id="account_code" class="form-control">
                                  </div>
                              </div>
                              <div class="row mt-2">
                                  <div class="col-12">
                                      <label>Description</label>
                                      <textarea class="form-control" rows="3" id="description" name="description" placeholder="Max. 500 Characters"></textarea>
                                  </div>
                              </div>
                          </div>
                          <div class="col-md-6 mt-4"> 
                              <div id="acnt-desc" class="form-control" name="detype" style="font-size: small;  height: fit-content;">
                              </div>
                          </div>
                      </div>
                      <div class="mt-3">
                          <div class="row">
                              <div class="col-md-4"></div>
                              <div class="col-md-4 d-flex justify-content-center">
                                  <button class="btn btn-outline-info" type="submit" id="saveNewAccount">Save</button>
                              </div>
                              <div class="col-md-4"></div>
                          </div>
                      </div>
                  </form>
              </div>
          </div>
      </div>
  </div> 
</div>   



<!-- --------------------------------------------------------------- ITEM MODAL --------------------------------------------------------------------------- -->














    <script>
   $(document).ready(function() {
        $('.select2').select2();
       
    });

    


   
        function toggleDiv() {
            var selectedValue = document.getElementById("adjust").value;
            var quantityDiv = document.getElementById("quantityDiv");
            var valueDiv = document.getElementById("valueDiv");

            if (selectedValue === "Quantity") {
                quantityDiv.style.display = "block";
                valueDiv.style.display = "none";
            } else {
                
                valueDiv.style.display = "block";
                quantityDiv.style.display = "none";
                console.log("hi")

            }
        }






    </script>




<!-- New Unit or Account Inside Item -->
<script>
  function return_to_item_modal(){
      $('#itm_modal_head').text('New Item')
      $('.new_modal_type_itm').val('Item')
      $('#new_unit_close').hide()
      $('#new_acc_close').hide()
      $('#new_itm_close').show()
      $('#unit_form').hide()
      $('#account_form').hide()
      $('#item_form').show()
      $('#newitem').find('.modal-dialog').removeClass('modal-md');
      $('#newitem').find('.modal-dialog').addClass('modal-xl');

      $('#unit_name').prop('required', false);

      $('#Account_type').prop('required', false);
      $('#accountName').prop('required', false);

      $('#nitm_name').prop('required', true);
      $('#nitm_type').prop('required', true);
      $('#nitm_unit').prop('required', true);
      $('#nitm_hsn').prop('required', true);
      $('#inclusive').prop('required', true);

      $('#unit_form')[0].reset();
      $('#account_form')[0].reset();
  }

  // Add New Unit Button is Clicked
  $('#new_unit_btn').click(function(){
      $('#itm_modal_head').text('New Unit')
      $('.new_modal_type_itm').val('Unit')
      $('#new_unit_close').show()
      $('#new_acc_close').hide()
      $('#new_itm_close').hide()
      $('#unit_form').show()
      $('#account_form').hide()
      $('#item_form').hide()
      $('#newitem').find('.modal-dialog').removeClass('modal-xl');
      $('#newitem').find('.modal-dialog').addClass('modal-md');

      $('#unit_name').prop('required', true);

      $('#Account_type').prop('required', false);
      $('#accountName').prop('required', false);

      $('#nitm_name').prop('required', false);
      $('#nitm_type').prop('required', false);
      $('#nitm_unit').prop('required', false);
      $('#nitm_hsn').prop('required', false);
      $('#inclusive').prop('required', false);
  });
  
  // Close Add Unit 
  $('#new_unit_close').click(function(){
      return_to_item_modal()
  });

  // Add New Account Button is Clicked
  $('#new_acc_btn').click(function(){
      $('#itm_modal_head').text('New Account')
      $('.new_modal_type_itm').val('Account')
      $('#new_unit_close').hide()
      $('#new_acc_close').show()
      $('#new_itm_close').hide()
      $('#unit_form').hide()
      $('#account_form').show()
      $('#item_form').hide()

      $('#unit_name').prop('required', false);

      $('#Account_type').prop('required', true);
      $('#accountName').prop('required', true);

      $('#nitm_name').prop('required', false);
      $('#nitm_type').prop('required', false);
      $('#nitm_unit').prop('required', false);
      $('#nitm_hsn').prop('required', false);
      $('#inclusive').prop('required', false);
  });

  // Close Add Account
  $('#new_acc_close').click(function(){
      return_to_item_modal()
  });

  // Close New Item 
  $('#new_itm_close').click(function(){
      $('#item_form')[0].reset();
      $('#unit_form')[0].reset();
      $('#account_form')[0].reset();
      $('#newitem').modal('hide')
  })
</script>

<!-- New Unit -->
<script>
  $('#unit_name').change(function(){
      var unit_name = $('#unit_name').val();
      if (unit_name != ""){
          $.ajax({
              type : 'GET',
              url:"{% url 'Fin_Check_New_Unit' %}",
              data:{
                  'unit_name' : unit_name,
                  csrfmiddlewaretoken: '{{ csrf_token }}'
              },
              success: function(response) {
                  if(response.is_exist){
                      $('#unit_name').val('')
                      $('#unit-name-error').text(response.message)
                  }else{
                      $('#unit-name-error').text('')
                  }
              },         
          });
      }
  });

  $('#newitem').submit(function(event){
      event.preventDefault();
      if($('.new_modal_type_itm').first().val() == 'Unit'){
          var unit_name = $('#unit_name').val();
          $.ajax({
              url: "{% url 'Fin_New_Unit' %}",
              type : 'GET',
              csrfmiddlewaretoken: '{{ csrf_token }}',
              data:{
                  unit_name : unit_name,
              },
              success: function(response) {
                  if(response.message == 'Success'){
                      var new_option = $(`<option class="text-uppercase" value="${unit_name}">${unit_name}</option>`);
                      $('#nitm_unit').append(new_option)
                  }
                  $('#unit_form')[0].reset();
                  return_to_item_modal()
              },
          });
      }
  });
</script>

<!-- New Account -->
<script>
  $('#subAccountCheckBox').change(function(){
      if($("#subAccountCheckBox").prop('checked')){
          $('#parentAccount').prop('required', true);
      }else{
          $('#parentAccount').prop('required', false);
      }
  });

  $(document).ready(function(){
      var Acnt_desc = document.getElementById("acnt-desc");
      Acnt_desc.innerHTML=`
          <b>Expense</b> <br>Reflects expenses incurred for running normal business operations, such as :<br/>
          <ul>
              <li>1.Advertisements and Marketing</li>
              <li>2.Business Travel Expenses</li>
              <li>3.License Fees</li>
              <li>4.Utility Expenses</li>
          </ul>`;

          var selectedValue = $('#Account_type').val();
          $.ajax({
              type : 'GET',
              url:"/Fin_check_accounts",
              data:{
                  type : selectedValue,
              },
              
              success: function(response) {
                  if(response.status){
                      $('#subAccountCheck').css('display','block');
                      var dropdown = $('#parentAccount');
                      dropdown.empty();
                      dropdown.append(`<option selected hidden value="">--Choose--</option>`)
                      $.each(response, function(key, value) {
                          for(let i=0; i<value.length; i++){
                              dropdown.append($('<option></option>').text(value[i].name).val(value[i].name))
                          }
                      });
                  }else{
                      
                  }
              },         
          });
  })

  function AccountTypeChange(selectBox) {
      var selectElement = document.getElementById("Account_type");
      var selectedValue = selectElement.value;
      var Acnt_desc = document.getElementById("acnt-desc");
      var acctype = document.getElementById("acctype");

      switch(selectedValue) {
          case "Expense":
              Acnt_desc.innerHTML=`
                  <b>Expense</b> <br>Reflects expenses incurred for running normal business operations, such as :<br/>
                  <ul>
                      <li>1.Advertisements and Marketing</li>
                      <li>2.Business Travel Expenses</li>
                      <li>3.License Fees</li>
                      <li>4.Utility Expenses</li>
                  </ul>`;
                  acctype.value="Expense"
              break;
          case "Cost Of Goods Sold":
              Acnt_desc.innerHTML=`
                  <b>Expense</b> <br>This indicates the direct costs attributable to the production of the goods sold by a company such as:<br/>
                  <ul>
                      <li>1.Material and Labor costs</li>
                      <li>2.Cost of obtaining raw materials</li>
                  </ul>`;
                  acctype.value="Expense"
              break;
          case "Other Expense":
              Acnt_desc.innerHTML=`
                  <b>Expense</b> <br>Track miscellaneous expenses incurred for activities other than primary business operations or create additional accounts to track default expenses like insurance or contribution towards charity.<br/>`;
                  acctype.value="Expense"
              break;
          default:
          Acnt_desc.innerHTML=`<b>Account Type</b> <br>Select an account type..<br/>`;
      }

      if(selectedValue !=""){
          $('#subAccountCheck').css('display','none')
          $('#subAccountCheckBox').prop('checked', $('#subAccountCheckBox').prop('checked') ? false : false);
          $('#parentAccountValue').css('display','none');

          $.ajax({
              type : 'GET',
              url:"/Fin_check_accounts",
              data:{
                  type : selectedValue,
              },
              
              success: function(response) {
                  if(response.status){
                      $('#subAccountCheck').css('display','block');
                      var dropdown = $('#parentAccount');
                      dropdown.empty();
                      dropdown.append(`<option selected hidden value="">--Choose--</option>`)
                      $.each(response, function(key, value) {
                          for(let i=0; i<value.length; i++){
                              dropdown.append($('<option></option>').text(value[i].name).val(value[i].name))
                          }
                      });
                  }else{
                      
                  }
              },         
          });
      }
  }

  $(document).ready(function() {
      $('#subAccountCheckBox').change(function() {
          if ($(this).is(':checked')) {
              $('#parentAccountValue').css('display','block');
              $('#parentAccount').prop('required',true);
          } else {
              $('#parentAccountValue').css('display','none');
              $('#parentAccount').prop('required',false);
          }
      });
  });

  $('#newitem').submit(function(event){
      event.preventDefault();
      if($('.new_modal_type_itm').first().val() == 'Account'){
          var name = $("#accountName").val();
          var type = $("#Account_type").val();
          var code = $("#account_code").val();
          var desc = $("#description").val();
          var subAcc = $("#subAccountCheckBox").prop('checked');
          var parentAcc = $("#parentAccount").val();

          if (name !="" && type !="" ){
              $.ajax({
                  url: "{% url 'Fin_New_Account' %}",
                  type : 'GET',
                  csrfmiddlewaretoken: '{{ csrf_token }}',
                  data:{
                      'account_name' : name,
                      'account_type' : type,
                      'account_code' : code,
                      'subAccountCheckBox' : subAcc,
                      'parent_account' : parentAcc,
                      'description' : desc,
                  },
                  
                  success: function(response) {
                      if(response.status){
                          var dropdown = $('#nitm_pur_acc');
                          dropdown.append($('<option></option>').text(name).val(name))
                          return_to_item_modal()
                      }else{
                          alert(response.message)
                      }
                  },         
              });
          }
          else{
              alert('Account name or Type cannot be blank.!')
          }
      }
  });
</script>

<!-- New Item -->
<script>
  // Reset Form When Closed
  $('#item_close').click(function(){
      $('#item_form')[0].reset();
      $('#unit_form')[0].reset();
      $('#account_form')[0].reset();
  })

  // If Inclusive Button is Clicked
  $('#inclusive').change(function(){
      $('#taxableDiv').show()
  });

  // If NonInclusive Button is Clicked
  $('#noninclusive').change(function(){
      $('#nitm_intra_tax').val(0)
      $('#nitm_inter_tax').val(0)
      $('#taxableDiv').hide()
  });

  // If Track Inventory is Clicked
  $('#track').change(function() {
      if($(this).is(':checked')){
          $("#inventorytrack").show();
      }else{
          $('#invacc').val('')
          $('#nitm_stock').val(0)
          $('#nitm_stock_rate').val(0)
          $("#inventorytrack").hide();;
      }
  });

  // Validate Item Name
  $('#nitm_name').change(function(){
      var itm_name = $('#nitm_name').val();
      if (itm_name != ""){
          $.ajax({
              type : 'POST',
              url:"{% url 'Fin_Check_New_Item_Name' %}",
              data:{
                  'itm_name' : itm_name,
                  csrfmiddlewaretoken: '{{ csrf_token }}'
              },
              success: function(response) {
                  if(response.is_exist){
                      $('#item-name-error').text(response.message)
                  }else{
                      $('#item-name-error').text('')
                  }
              },         
          });
      }
  });

  // Validate Item HSN
  $('#nitm_hsn').change(function(){
      var itm_hsn = $('#nitm_hsn').val();
      if (itm_hsn != ""){
          $.ajax({
              type : 'POST',
              url:"{% url 'Fin_Check_New_Item_HSN' %}",
              data:{
                  'itm_hsn' : itm_hsn,
                  csrfmiddlewaretoken: '{{ csrf_token }}'
              },
              success: function(response) {
                  if(response.is_exist){
                      $('#item-hsn-error').text(response.message)
                  }else{
                      $('#item-hsn-error').text('')
                  }
              },         
          });
      }
  });

  // New Item 
  $('#newitem').submit(function(event){
  
      event.preventDefault();
      if($('.new_modal_type_itm').first().val() == 'Item'){
          if($('#inclusive').is(':checked')){
              taxref = 'Taxable'
          }else{
              taxref = 'Non Taxable'
          }
          $.ajax({
              url: "{% url 'Fin_New_Item2' %}",
              type : 'GET',
              csrfmiddlewaretoken: '{{ csrf_token }}',
              data:{
                  name : $('#nitm_name').val(),
                  type : $('#nitm_type').val(),
                  unit : $('#nitm_unit').val(),
                  hsn : $('#nitm_hsn').val(),
                  taxref : taxref,
                  intra_st : $('#nitm_intra_tax').val(),
                  inter_st : $('#nitm_inter_tax').val(),
                  pcost : $('#nitm_pur_price').val(),
                  pur_account : $('#nitm_pur_acc').val(),
                  pur_desc : $('#nitm_pur_acc').val(),
                  salesprice : $('#nitm_sale_price').val(),
                  sale_account : $('#nitm_sale_acc').val(),
                  sale_desc : $('#nitm_sale_acc').val(),
                  invacc : $('#invacc').val(),
                  stock : $('#nitm_stock').val(),
                  stock_rate : $('#nitm_stock_rate').val(),
                  min_stock : $('#nitm_min_stock').val(),
              },
        

            success: function(response) {
                    if(response.status){
                        
                        var dropdown = $('.inneritem1');
                        dropdown.empty();
                        // var dropdown2 = $('.inneritem' + rowNum)
                        // dropdown2.empty();

                        // dropdown2.append(`<option value="" selected>Choose</option>`);
                        dropdown.append(`<option value="" selected>Choose</option>`);

                        $.each(response, function(key, value) {
                            for(let i=0; i<value.length; i++){
                                if(value[i].name == name){
                                    dropdown.append($('<option selected></option>').text(value[i].name).val(value[i].id))
                                    // dropdown2.append($('<option selected></option>').text(value[i].name).val(value[i].id))
                                }else{
                                        dropdown.append($('<option></option>').text(value[i].name).val(value[i].id))
                                }   
                            }
                        });


                    }else{
                        alert("Sorry this item already exists!")
                    }
                

                  $('#item_form')[0].reset();
                  $('#newitem').modal('hide');
              },
          });
      }
  });

</script>









  

   
 <!-- #search dropdown -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js" defer></script>

{% endblock %}